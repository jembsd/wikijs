<!-- TITLE: Windows Tips -->
<!-- SUBTITLE: A quick summary of Windows Post -->



# Alternate Data Streams

Sometimes, <a href="https://blogs.technet.microsoft.com/askcore/2013/03/24/alternate-data-streams-in-ntfs/" class="reference external">Alternate Data Stream</a> can be used to hide data in streams.

The output shows not only the name of the ADS and its size, but also the unnamed data stream and its size is also listed (shown as :$DATA).

## Using powershell

    PS > Get-Item -Path C:\Users\Administrator\example.zip -stream *

    Filename: C:\Users\Administrator\example.zip

    Stream             Length
    ------             -------
    :$DATA             8
    pass.txt           4

Now, we know the name of the ADS, We can use the Get-Content cmdlet to query its contents.

    Get-Content -Path C:\Users\Administrator\example.zip -Stream pass.txt
    The password is Passw0rd!

Check a directory for ADS?

```
gci -recurse | % { gi $_.FullName -stream * } | where stream -ne ':$Data'
```

## Using dir

Current directory ADS Streams:

    dir /r | find ":$DATA"

Sub-directories too:

    dir   /s /r | find ":$DATA"

Reading the hidden stream:

    more < testfile.txt:hidden_stream::$DATA

# NTDS.dit and SYSTEM hive

If you have found files such as

```
    IP_psexec.ntdsgrab._333512.dit: Extensible storage engine DataBase, version 0x620, checksum 0x16d44752, page size 8192, DirtyShutdown, Windows version 6.1
    IP_psexec.ntdsgrab._089134.bin: MS Windows registry file, NT/2000 or above
```
Probably, there are dump of domain controller NTDS.dit file, from which passwords can be extracted. Utilize,

    python secretsdump.py -ntds /root/ntds_cracking/ntds.dit -system /root/ntds_cracking/systemhive LOCAL

 Powershell

# Recovering password from System.Security.SecureString

If we have windows credentials stored as System.Security.SecureString, we can use

    $BSTR = [System.Runtime.InteropServices.Marshal]::SecureStringToBSTR($SecurePassword)
    $UnsecurePassword = [System.Runtime.InteropServices.Marshal]::PtrToStringAuto($BSTR)

or

    $UnsecurePassword = (New-Object PSCredential "user",$SecurePassword).GetNetworkCredential().Password

Example:

    PS> $PlainPassword = Read-Host -AsSecureString  "Enter password"
    PS> Enter password: ***
    PS> $PlainPassword
    PS> System.Security.SecureString
    PS> $UnsecurePassword1 = (New-Object PSCredential "user",$PlainPassword).GetNetworkCredential().Password
    PS> $UnsecurePassword1
    PS> yum

# Zip or unzip using ONLY Windowsâ€™ built-in capabilities?

Powershell way

    Add-Type -A System.IO.Compression.FileSystem
    [IO.Compression.ZipFile]::CreateFromDirectory('foo', 'foo.zip')
    [IO.Compression.ZipFile]::ExtractToDirectory('foo.zip', 'bar')
