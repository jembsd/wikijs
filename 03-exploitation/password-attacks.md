<!-- TITLE: 06 - Password Attacks -->
<!-- SUBTITLE: Generating custom wordlists, cracking hashes and attacking online authentication mechanisms -->

# Wordlists

## Generating custom wordlists

If we are able to do a dictionary-attack against a service it is important that we use a good dictionary. We can use e generic one. But we can also generate a custom wordlist based on certain criteria. That is what we are going to do in this chapter.

Remember people often use their birth dates, address, street address, pets, family members, etc.

### Who is the target?

The target might be a specific company or person.

### Password rules

The service you want to hack might have specific password rules. Must contain certain characters, must be of certain length etc.

### Combine a small/semi-small dict with a custom

To combine two wordlists you can just do

```text
cat wordlist.txt >> wordlist2.txt
```

### Create a custom wordlist

#### **Html2dic - Build dictionary from html**

You can build a dictionary from a html-page.

```text
curl http://example.com > example.txt
```

Then run:

```text
html2dic example.txt
```

Then you should probably remove duplicates.

#### Cewl - Spider and build dictionary

```text
cewl -w createWordlist.txt https://www.example.com
```

Add minimum password length:

```text
cewl -w createWordlist.txt -m 6 https://www.example.com
```

#### Improve the custom wordlis

As we all know few password are just simple words. Many use numbers and special characters. To improve our password list we can use john the ripper. We can input our own rules, or we can just use the standard john-the-ripper rules

```text
john ---wordlist=wordlist.txt --rules --stdout > wordlist-modified.txt
```

#### Working with uppercase and lowercase

If you end up with a list of uppercase passwords, you should also extract them lowercase and vice-versa

```text
# Convert lowercase to uppercase
tr [a-z] [A-Z] < infile.txt > wordlist.txt
```
# Offline Password Cracking

We might find passwords or other credentials in databases. These are often hashed, so we need to first identify which hash it is and then try to crack it. The first step is to identify the hash-algorithm that was used to hash the password.

## Identify hash

There are generally speaking three pieces of data we can use to identify a hash.

* The length of the hash
* The character set
* Any special characters

In order to identify a hash we can either use specialized tools that analyze the hash and then return a guess on which algorithm it is. An easier way is of course to just look in the documentation of the software where you found the hashes. It usually says in the documentation or the source code which type of hash is being used.

In kali we can use `hash-identifier` or `hashid`:

```text
hash-identifier
hashid
```

Or try these online services:

[http://www.onlinehashcrack.com/hash-identification.php](http://www.onlinehashcrack.com/hash-identification.php)

[https://md5hashing.net/hash\_type\_checker](https://md5hashing.net/hash_type_checker)

## Cracking the hash

Okay so now we know what hash it is, let's get cracking.

If you want to try out the functionality of hashcat or john the ripper you can find example hashes here: [http://openwall.info/wiki/john/sample-hashes](http://openwall.info/wiki/john/sample-hashes).

### Hashcat

Look for the specific type of hash you want to crack in the list produced by the following command:

```text
hashcat --help
```

My hash was a Apache md5, so I will use the corresponding code for it, `1600`

`-a 0` - straight

`-o found.txt` - where the cracked hash outputs

\`admin.hash" - the hash you want to crack.

`/usr/share/hashcat/rules/rockyou-30000.rule` - the wordlist we use

```text
hashcat -m 11 -a 0 -o found.txt admin.hash /usr/share/hashcat/rules/rockyou-30000.rule
```

### John the ripper (jtr)

So this is how you usually crack passwords with john

```text
john --wordlist=wordlist.txt dump.txt
```

If you do not find the password you can add the john-rules. Which add numbers and such things to each password.

```text
john --rules --wordlist=wordlist.txt dump.txt
```

#### Hash formats

x

#### Linux shadow password

First you need to combine the passwd file with the shadow file using the unshadow-program.

```text
unshadow passwd-file.txt shadow-file.txt > unshadowed.txt
john --rules --wordlist=wordlist.txt unshadowed.txt
```

### Rainbow tables

So basically a rainbow table is a precalculated list of passwords. So instead of having to hash the word you want to try you create a list of hashes. So you do not have to hash them before comparing. This might take a long time to do, hashing a whole wordlist, but when you do the comparison between the password and the test-word it will go a lot faster.

## Using Online Tools

### findmyhash

You can use findmyhash

Here is an example of how to use it:

```text
findmyhash LM -h 6c3d4c343f999422aad3b435b51404ee:bcd477bfdb45435a34c6a38403ca4364
```

### Cracking

Crackstation  
[https://crackstation.net/](https://crackstation.net/)

Hashkiller  
[https://hashkiller.co.uk/](https://hashkiller.co.uk/)

Crackpot  
[http://cracker.offensive-security.com/](http://cracker.offensive-security.com/)

* Google hashes
* Search pastebin

## Windows

If you find a local file inclusion vulnerability you might be able to retrieve two fundamental files from it. the `system` registry and the `SAM` registry. There two files/registries are all we need to get the machines hashes.  
These files can be found in several different locations in windows. Here they are:

    ```text
    %SYSTEMROOT%\repair\SAM
    windows\repair\SAM
    %SYSTEMROOT%\System32\config\RegBack\SAM
    SYSTEMROOT%\repair\system
    %SYSTEMROOT%\System32\config\RegBack\system
    ```

So if the manage to get your hands on both of these files you can extract the password hashed like this:

```text
pwdump system sam
```

# Online Password Cracking

There are several tools specialised for brute forcing online. There are several different services that are common for bruteforce. For example: VNC, SSH, FTP, SNMP, POP3, HTTP, RLOGIN.

## Process

Online password attacks take time, so it's best to try the most common or likely passwords first before using more exhaustic wordlists or brute force combinations. In general, I find something like this works best

1. A quick `-e nsr` check with Hydra to test for password as username, reverse or null
2. A [custom list](generate-custom-wordlist.md) generated from the target media and assets including users, html, competitors etc.
3. Darknet Top 10 or 100 passwords
4. A smaller standard list such as nmap default
5. A larger more extensive list like Rockyou

## SSH, FTP, SMB

### Using Hydra

#### Hydra's Quick check

This option will run a quick check by attempting password as username, username in reverse and null passwords

```text
hydra -l user -e nsr 10.10.10.140 -s 21 ftp
hydra -L /path/userlist.txt -e nsr 10.10.10.228 -s 22 ssh
```

#### Using wordlists

```text
hydra -l root -P /usr/share/wordlists/SecLists/Passwords/darkweb2017-top100.txt 10.10.10.228 -s 22 ssh
```

### Using Patator

#### Rlogin

```
patator rlogin_login host=10.10.10.228 user=user password=FILE0 0=/usr/share/wordlists/SecLists/Passwords/darkweb2017-top100.txt -x 'reset:egrep!=Login incorrect.+login:' -x ignore:fgrep=Password:
```

#### SSH

```
patator ssh_login host=10.10.10.228 user=user password=FILE0 0=/usr/share/wordlists/nmap.lst -x ignore:mesg='Authentication failed.'
```

### Using Medusa

```text
medusa -h 10.20.20.150 -P /usr/share/wordlists/nmap.lst -u admin -M smbnt
```


## HTACCESS

You can password protect directories with apache pretty easily. Just configure the htaccess \(I exaplin this in the chapter on Common ports\).

It can then be brute forced like this:

```text
medusa -h 192.168.1.101 -u admin -P wordlist.txt -M http -m DIR:/test -T 10
```

### Logins

Use Burp suite.

1. Intecept a login attempt.
2. Right-lick "Send to intruder". Select Sniper if you have nly one field you want to bruteforce. If you for example already know the username. Otherwise select cluster-attack.
3. Select your payload, your wordlist.
4. Click attack.
5. Look for response-length that differs from the rest.

## SNMP

```text
hydra -P wordlist.txt -v 102.168.0.101 snmp
```

## RDP

For RDP we can use Ncrack.

```text
ncrack -vv --user admin -P password-file.txt rdp://192.168.0.101
```

# Password lists

* Darknet Top 10/100/10,000 lists (SecLists)
* Rockyou.txt (Default)
* nmap.lst


# References
